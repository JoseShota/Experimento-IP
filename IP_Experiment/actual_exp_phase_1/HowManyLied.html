{% extends "global/Page.html" %}
{% load static %}

{% block content %}
<h1>Guess How Many Members Chose a Different Opinion</h1>

<p class="mb-3">
    <strong>Round {{ player.round_number }} of {{ C.NUM_ROUNDS }}</strong>
</p>

<!-- repeat topic + treatment from TopicTreatment -->
<p>
    The topic of the conversation for this round is:
    <br><strong>{{ topic }}</strong>
</p>
<p>For this topic we have formed your group as illustrated below:</p>
<div class="text-center my-4">
    <img src="{% static treatment_png %}"
         alt="Treatment diagram"
         class="img-fluid"
         style="max-width: 420px;">
</div>
<hr>

<!-- slider styling (reuse your WTP styles) -->
<style>
  .wtpmax-range {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    max-width: 600px;
    height: .5rem;
    border-radius: .25rem;
    background: #dee2e6;
    cursor: pointer;
    margin: 0 auto .25rem;
    display: block;
  }
  .wtpmax-range.untouched {
    background: #dee2e6 !important;
  }
  .wtpmax-range.untouched::-webkit-slider-thumb,
  .wtpmax-range.untouched::-moz-range-thumb {
    background: transparent;
    border: 0;
    height: 0;
    width: 0;
  }
  .wtpmax-range::-webkit-slider-thumb,
  .wtpmax-range::-moz-range-thumb {
    height: 1rem;
    width: 1rem;
    border-radius: 50%;
    background: #0d6efd;
    cursor: pointer;
  }
  .slider-legend {
    font-size: .85rem;
    color: #6c757d;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }
  .slider-legend .center {
    visibility: hidden;
  }
</style>

{% for item in items %}
  <div class="mb-4">
    <strong>{{ item.index }}.</strong>
    You are in a group with two other participants, and {{ item.description }}.
    <br>
    <em>How many of the other members do you think expressed a different opinion than what they chose privately?</em>
    </em><br><br>
    <div>
      <input
        type="range"
        class="wtpmax-range untouched"
        id="{{ item.field_name }}"
        name="{{ item.field_name }}"
        min="0" max="2" step="1" value="0"
      >
    </div>
    <div class="d-flex justify-content-between slider-legend">
      <span class="left">0 members<br><small>(none)</small></span>
      <span id="{{ item.field_name }}_val" class="center">0</span>
      <span class="right">2 members<br><small>(both)</small></span>
    </div>
  </div>
  <hr>
{% endfor %}

<script>
document.addEventListener('input', function (e) {
  if (e.target.type === 'range') {
    const rng = e.target;
    const max = parseInt(rng.max, 10);
    const val = parseInt(rng.value, 10);
    const label = document.getElementById(rng.id + '_val');

    if (rng.classList.contains('untouched')) {
      rng.classList.remove('untouched');
      label.style.visibility = 'visible';
    }
    label.innerText = 'I think ' + val + ' of the other two members chose a different opinion.';

    const pct = (val / max) * 100;
    rng.style.background =
      'linear-gradient(to right, #0d6efd 0%, #0d6efd ' + pct +
      '%, #dee2e6 ' + pct + '%, #dee2e6 100%)';
  }
});
</script>

{{ next_button }}
{% endblock %}





